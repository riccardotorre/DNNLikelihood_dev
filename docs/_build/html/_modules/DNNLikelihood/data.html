

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DNNLikelihood.data &mdash; DNNLikelihood</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.2/gh-fork-ribbon.min.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> DNNLikelihood
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code.html">Python module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citations.html">Use and Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indices_tables.html">Indices</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DNNLikelihood</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>DNNLikelihood.data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for DNNLikelihood.data</h1><div class="highlight"><pre>
<span></span><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">builtins</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">timeit</span> <span class="kn">import</span> <span class="n">default_timer</span> <span class="k">as</span> <span class="n">timer</span>

<span class="kn">import</span> <span class="nn">deepdish</span> <span class="k">as</span> <span class="nn">dd</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">inference</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">.corner</span> <span class="kn">import</span> <span class="n">corner</span><span class="p">,</span> <span class="n">extend_corner_range</span><span class="p">,</span> <span class="n">get_1d_hist</span>
<span class="kn">from</span> <span class="nn">.show_prints</span> <span class="kn">import</span> <span class="n">Verbosity</span><span class="p">,</span> <span class="nb">print</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="n">kubehelix</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;cubehelix&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">reds</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">greens</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Greens&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">blues</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">mplstyle_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;matplotlib.mplstyle&quot;</span><span class="p">)</span>

<span class="n">header_string</span> <span class="o">=</span> <span class="s2">&quot;==============================&quot;</span>
<span class="n">footer_string</span> <span class="o">=</span> <span class="s2">&quot;------------------------------&quot;</span>

<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../../data/class.html#DNNLikelihood.Data">[docs]</a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="n">Verbosity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class contains the ``Data`` object representing the dataset used for training, validating and testing</span>
<span class="sd">    the DNNLikelihood. It can be creaded both feeding X and Y data or by loading an existing ``Data`` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Data.__init__"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">data_X</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">data_Y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">pars_central</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">pars_pos_poi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">pars_pos_nuis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">pars_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">pars_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">test_fraction</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">load_on_RAM</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">output_folder</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">input_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :mod:`Data &lt;data&gt;` object can be initialized in two different ways, depending on the value of</span>
<span class="sd">        the :argument:`input_file` argument.</span>

<span class="sd">        - :argument:`input_file` is ``None`` (default)</span>

<span class="sd">            All other arguments are parsed and saved in corresponding attributes. If no :argument:`name` is given,</span>
<span class="sd">            then one is created.</span>
<span class="sd">            The object is saved upon creation through the :meth:`Data.save &lt;DNNLikelihood.Data.save&gt;` method.</span>

<span class="sd">        - :argument:`input_file` is not ``None``</span>

<span class="sd">            The object is reconstructed from the input files through the private method</span>
<span class="sd">            :meth:`Data.__load &lt;DNNLikelihood.Data._Data__load&gt;`.</span>
<span class="sd">            If the :argument:`load_on_RAM` argument is ``True``, then all samples are loaded into RAM, otherwise the dataset is</span>
<span class="sd">            kept open and data are retrieved on demand.</span>
<span class="sd">            Depending on the value of the input argument :argument:`output_folder` the :meth:`Data.__init__ &lt;DNNLikelihood.Data.__init__&gt;` method behaves as follows:</span>

<span class="sd">                - If :argument:`output_folder` is ``None`` (default)</span>
<span class="sd">                    </span>
<span class="sd">                    The attribute :attr:`Data.output_folder &lt;DNNLikelihood.Data.output_folder&gt;`</span>
<span class="sd">                    is set from the :attr:`Data.input_folder &lt;DNNLikelihood.Data.input_folder&gt;` one.</span>
<span class="sd">                - If :argument:`output_folder` corresponds to a path different from that stored in the loaded :attr:`Data.output_folder &lt;DNNLikelihood.Data.output_folder&gt;` attribute</span>
<span class="sd">                    </span>
<span class="sd">                    - if path stored in the loaded :attr:`Data.output_folder &lt;DNNLikelihood.Data.output_folder&gt;` attribute exists, then its content is copied to the new ``output_folder`` (if the new ``output_foler`` already exists it is renamed by adding a timestamp);</span>
<span class="sd">                    - if path stored in the loaded :attr:`Data.output_folder &lt;DNNLikelihood.Data.output_folder&gt;` does not exists, then the content of the path :attr:`Data.input_folder &lt;DNNLikelihood.Data.input_folder&gt;` is copied to the new ``output_folder``.</span>
<span class="sd">                - If :argument:`output_folder` corresponds to the same path stored in the loaded :attr:`Data.output_folder &lt;DNNLikelihood.Data.output_folder&gt;` attribute</span>
<span class="sd">                    </span>
<span class="sd">                    Output folder, files, and path attributes are not updated and everything is read from the loaded object.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            See class :ref:`Arguments documentation &lt;data_arguments&gt;`.</span>

<span class="sd">        - **Creates files**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;` (only the first time the object is created, i.e. if :argument:`input_file` is ``None``)</span>
<span class="sd">            - :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;` (only the first time the object is created, i.e. if :argument:`input_file` is ``None``)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initialize Data object.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span> <span class="o">=</span> <span class="n">output_folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_file</span> <span class="o">=</span> <span class="n">input_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_define_input_files</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="p">{</span><span class="n">timestamp</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;created&quot;</span><span class="p">}}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_define_name</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_define_output_files</span><span class="p">(</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span> <span class="o">=</span> <span class="n">data_X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span> <span class="o">=</span> <span class="n">data_Y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_define_data</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span> <span class="o">=</span> <span class="n">pars_pos_poi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span> <span class="o">=</span> <span class="n">pars_pos_nuis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_central</span> <span class="o">=</span> <span class="n">pars_central</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_labels</span> <span class="o">=</span> <span class="n">pars_labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_bounds</span> <span class="o">=</span> <span class="n">pars_bounds</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_define_pars</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_fraction</span> <span class="o">=</span> <span class="n">test_fraction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__define_test_fraction</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_on_RAM</span> <span class="o">=</span> <span class="n">load_on_RAM</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Figures&quot;</span><span class="p">:</span> <span class="p">{}}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_on_RAM</span> <span class="o">=</span> <span class="n">load_on_RAM</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span> <span class="o">=</span> <span class="n">dtype</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span> <span class="o">=</span> <span class="n">dtype</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__load</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_define_output_files</span><span class="p">(</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__define_test_fraction</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reset_predictions</span><span class="p">(</span><span class="n">delete_figures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">check_figures_dic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">],</span><span class="n">output_figures_folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X_train&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[]],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">),</span> <span class="s2">&quot;Y_train&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">),</span>
                                <span class="s2">&quot;X_val&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[]],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">),</span> <span class="s2">&quot;Y_val&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">),</span>
                                <span class="s2">&quot;X_test&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[]],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">),</span> <span class="s2">&quot;Y_test&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">),</span>
                                <span class="s2">&quot;idx_train&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">),</span> <span class="s2">&quot;idx_val&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">),</span> <span class="s2">&quot;idx_test&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)}</span></div>

    <span class="k">def</span> <span class="nf">__check_define_input_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private method used by the :meth:`Data.__init__ &lt;DNNLikelihood.Data.__init__&gt;` one</span>
<span class="sd">        to set the attributes corresponding to input files:</span>

<span class="sd">            - :attr:`Data.input_log_file &lt;DNNLikelihood.Data.input_log_file&gt;`</span>
<span class="sd">            - :attr:`Data.input_h5_file &lt;DNNLikelihood.Data.input_h5_file&gt;`</span>
<span class="sd">            - :attr:`Data.input_samples_h5_file &lt;DNNLikelihood.Data.input_samples_h5_file&gt;`</span>

<span class="sd">        depending on the value of the </span>
<span class="sd">        :attr:`Data.input_file &lt;DNNLikelihood.Data.input_file&gt;` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_h5_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_samples_h5_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_log_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_folder</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No Data input files and folders specified.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_h5_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="o">+</span><span class="s2">&quot;.h5&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_samples_h5_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="o">+</span><span class="s2">&quot;_samples.h5&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_log_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="o">+</span><span class="s2">&quot;.log&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_folder</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data input folder set to</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_folder</span><span class="p">,</span><span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_define_output_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private method used by the :meth:`Data.__init__ &lt;DNNLikelihood.Data.__init__&gt;` one</span>
<span class="sd">        to set the attributes corresponding to output folders</span>
<span class="sd">        </span>
<span class="sd">            - :attr:`DnnLik.output_figures_folder &lt;DNNLikelihood.DnnLik.output_figures_folder&gt;`</span>
<span class="sd">            - :attr:`DnnLik.output_folder &lt;DNNLikelihood.DnnLik.output_folder&gt;`</span>
<span class="sd">        </span>
<span class="sd">        and output files</span>

<span class="sd">            - :attr:`DnnLik.output_figures_base_file &lt;DNNLikelihood.DnnLik.output_figures_base_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_predictions_json_file &lt;DNNLikelihood.Data.output_predictions_json_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;`</span>

<span class="sd">        depending on the values of the </span>
<span class="sd">        :attr:`Data.output_folder &lt;DNNLikelihood.Data.output_folder&gt;` attribute.</span>
<span class="sd">        It also creates the folder </span>
<span class="sd">        :attr:`Data.output_folder &lt;DNNLikelihood.Data.output_folder&gt;` if </span>
<span class="sd">        it does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_folder</span><span class="p">:</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">copy_and_save_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_folder</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">check_create_folder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span> <span class="o">=</span>  <span class="n">utils</span><span class="o">.</span><span class="n">check_create_folder</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;figures&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_figures_base_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_figure&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_figures_base_file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_figures_base_file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_h5_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.h5&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_samples_h5_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_samples.h5&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_log_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.log&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_predictions_json_file</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_predictions.json&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data output folder set to</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_folder</span><span class="p">,</span><span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__check_define_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private method used by the :meth:`Data.__init__ &lt;DNNLikelihood.Data.__init__&gt;` one</span>
<span class="sd">        to define the :attr:`Data.name &lt;DNNLikelihood.Data.name&gt;` attribute.</span>
<span class="sd">        If it is ``None`` it replaces it with</span>
<span class="sd">        ``&quot;model_&quot;+datetime.now().strftime(&quot;%Y-%m-%d-%H-%M-%S.%fZ&quot;)[:-3]+&quot;_data&quot;``,</span>
<span class="sd">        otherwise it appends the suffix &quot;_data&quot; (preventing duplication if it is already present).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;model_&quot;</span><span class="o">+</span><span class="n">timestamp</span><span class="o">+</span><span class="s2">&quot;_data&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">check_add_suffix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;_data&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_define_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Private method used by the :meth:`Data.__init__ &lt;DNNLikelihood.Data.__init__&gt;` one</span>
<span class="sd">        to check that data_X and data_Y have the same length, to set the data type attributes</span>
<span class="sd">        :attr:`Data.dtype_required &lt;DNNLikelihood.Data.dtype_required&gt;` and</span>
<span class="sd">        :attr:`Data.dtype_stored &lt;DNNLikelihood.Data.dtype_stored&gt;` (defaults &quot;float64&quot;), and to convert</span>
<span class="sd">        :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` and :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;`</span>
<span class="sd">        into the dtype corresponding to :attr:`Data.dtype_stored &lt;DNNLikelihood.Data.dtype_stored&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype_stored</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span> <span class="o">=</span> <span class="s2">&quot;float64&quot;</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype_stored</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype_stored</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_stored</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_stored</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;data_X and data_Y have different length.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_define_pars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private method used by the :meth:`Data.__init__ &lt;DNNLikelihood.Data.__init__&gt;` one</span>
<span class="sd">        to check the consistency of the attributes</span>

<span class="sd">            - :attr:`Data.pars_pos_nuis &lt;DNNLikelihood.Data.pars_pos_nuis&gt;`</span>
<span class="sd">            - :attr:`Data.pars_pos_poi &lt;DNNLikelihood.Data.pars_pos_poi&gt;`</span>
<span class="sd">            - :attr:`Data.pars_central &lt;DNNLikelihood.Data.pars_pos_poi&gt;`</span>
<span class="sd">            - :attr:`Data.pars_labels &lt;DNNLikelihood.Data.pars_labels&gt;`</span>
<span class="sd">            - :attr:`Data.pars_bounds &lt;DNNLikelihood.Data.pars_bounds&gt;` </span>

<span class="sd">        and to convert the attributes</span>

<span class="sd">            - :attr:`Data.pars_pos_nuis &lt;DNNLikelihood.Data.pars_pos_nuis&gt;`</span>
<span class="sd">            - :attr:`Data.pars_pos_poi &lt;DNNLikelihood.Data.pars_pos_poi&gt;`</span>
<span class="sd">            - :attr:`Data.pars_central &lt;DNNLikelihood.Data.pars_pos_poi&gt;`</span>
<span class="sd">            - :attr:`Data.pars_bounds &lt;DNNLikelihood.Data.pars_bounds&gt;` </span>
<span class="sd">        </span>
<span class="sd">        to |numpy_link| arrays.</span>
<span class="sd">        If no parameters positions are specified, all parameters are assumed to be parameters of interest.</span>
<span class="sd">        If only the position of the parameters of interest or of the nuisance parameters is specified,</span>
<span class="sd">        the other is automatically generated by matching dimensions.</span>
<span class="sd">        If labels are not provided then :attr:`Data.pars_labels &lt;DNNLikelihood.Data.pars_labels&gt;`</span>
<span class="sd">        is set to the value of :attr:`Data.pars_labels_auto &lt;DNNLikelihood.Data.pars_labels_auto&gt;`.</span>
<span class="sd">        If parameters bounds are not provided, they are set to ``(-np.inf,np.inf)``.</span>
<span class="sd">        A check is performed on the length of the four attributes and an Exception is raised if the length</span>
<span class="sd">        does not match :attr:`Data.ndims &lt;DNNLikelihood.Data.ndims&gt;`.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_central</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_central</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_central</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_central</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The length of the parameters central values array does not match the number of dimensions.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_central</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No central values for the parameters &#39;pars_central&#39; has been specified. They have been set to zero for all</span><span class="se">\</span>
<span class="s2">                parameters. If they are known it == better to build the object providing parameters central values.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The number of parameters positions do not match the number of dimensions.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The positions of the parameters of interest (pars_pos_poi) and of the nuisance parameters (pars_pos_nuis) have not been specified. Assuming all parameters are parameters of interest.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Only the positions of the nuisance parameters have been specified. Assuming all other parameters are parameters of interest.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Only the positions of the parameters of interest have been specified. Assuming all other parameters are nuisance parameters.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pars_labels_auto</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">define_pars_labels_auto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_poi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_pos_nuis</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_labels_auto</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The number of parameters labels do not match the number of dimensions.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_bounds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pars_bounds</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The length of the parameters bounds array does not match the number of dimensions.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private method used by the :meth:`Data.__init__ &lt;DNNLikelihood.Data.__init__&gt;` one </span>
<span class="sd">        to load a previously saved</span>
<span class="sd">        :mod:`Data &lt;data&gt;` object from the files </span>
<span class="sd">        </span>
<span class="sd">            - :attr:`Data.input_samples_h5_file &lt;DNNLikelihood.Data.input_samples_h5_file&gt;`</span>
<span class="sd">            - :attr:`Data.input_h5_file &lt;DNNLikelihood.Data.input_h5_file&gt;`</span>
<span class="sd">            - :attr:`Data.input_log_file &lt;DNNLikelihood.Data.input_log_file&gt;`</span>

<span class="sd">        If :attr:`Data.load_on_RAM &lt;DNNLikelihood.Data.load_on_RAM&gt;` is ``True``, then all samples are loaded into RAM, </span>
<span class="sd">        otherwise the dataset is kept open and data are retrieved on demand.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_h5_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_log_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">dictionary</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opened_dataset</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_samples_h5_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opened_dataset</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_on_RAM</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opened_dataset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;loaded&quot;</span><span class="p">,</span> 
                               <span class="s2">&quot;files names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_samples_h5_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                               <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_log_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                               <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_h5_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]}</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data object loaded in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_on_RAM</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Samples loaded on RAM.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__define_test_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Private method used by the :meth:`Data.__init__ &lt;DNNLikelihood.Data.__init__&gt;` one</span>
<span class="sd">        to set the :attr:`Data.test_fraction &lt;DNNLikelihood.Data.test_fraction&gt;` attribute and, from this, the</span>
<span class="sd">        two attributes :attr:`Data.train_range &lt;DNNLikelihood.Data.train_range&gt;` and </span>
<span class="sd">        :attr:`Data.test_range &lt;DNNLikelihood.Data.test_range&gt;` containing the range of indices of</span>
<span class="sd">        the train (and validation) and test sets given by</span>
<span class="sd">        :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` and</span>
<span class="sd">        :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_fraction</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_fraction</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">test_fraction</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">test_fraction</span><span class="p">))),</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__check_sync_data_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private method used to check that indices and data are synced in the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;`</span>
<span class="sd">        dictionary. It is called by all methods generating or updating data.</span>
<span class="sd">        This is needed when the :mod:`Data &lt;data&gt;` object is used by the </span>
<span class="sd">        :class:`DnnLik &lt;DNNLikelihood.DnnLik&gt;` one. In particular, when the latter is imported from files</span>
<span class="sd">        only indices are loaded and properly put in the corresponding </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;`, while, to gain speed, data are not.</span>
<span class="sd">        Whenever the :class:`DnnLik &lt;DNNLikelihood.DnnLik&gt;` needs data, and calls any of its method that</span>
<span class="sd">        generate them, the method :meth:`Data.__check_sync_data_dictionary &lt;DNNLikelihood.Data._Data__check_sync_data_dictionary&gt;`</span>
<span class="sd">        automatically loads the data corresponding to the existing indices in the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` of the corresponding </span>
<span class="sd">        :mod:`Data &lt;data&gt;` object. See the documentation of </span>
<span class="sd">        the :mod:`DNNLikelihood &lt;dnn_likelihood&gt;` object for more details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_train&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Loaded train data corresponding to existing indices.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_val&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Loaded val data corresponding to existing indices.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Loaded test data corresponding to existing indices.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__set_pars_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars_labels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private method that returns the ``pars_labels`` choice based on the ``pars_labels`` input.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **pars_labels**</span>
<span class="sd">            </span>
<span class="sd">                Could be either one of the keyword strings ``&quot;original&quot;`` and ``&quot;generic&quot;`` or a list of labels</span>
<span class="sd">                strings with the length of the parameters array. If ``pars_labels=&quot;original&quot;`` or ``pars_labels=&quot;generic&quot;``</span>
<span class="sd">                the function returns the value of :attr:`Sampler.pars_labels &lt;DNNLikelihood.Data.pars_labels&gt;`</span>
<span class="sd">                or :attr:`Data.pars_labels_auto &lt;DNNLikelihood.Data.pars_labels_auto&gt;`, respectively,</span>
<span class="sd">                while if ``pars_labels`` == a list, the function just returns the input.</span>

<span class="sd">                    - **type**: ``list`` or ``str``</span>
<span class="sd">                    - **shape of list**: ``[ ]``</span>
<span class="sd">                    - **accepted strings**: ``&quot;original&quot;``, ``&quot;generic&quot;``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pars_labels</span> <span class="o">==</span> <span class="s2">&quot;original&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_labels</span>
        <span class="k">elif</span> <span class="n">pars_labels</span> <span class="o">==</span> <span class="s2">&quot;generic&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars_labels_auto</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pars_labels</span>

<div class="viewcode-block" id="Data.define_test_fraction"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.define_test_fraction">[docs]</a>    <span class="k">def</span> <span class="nf">define_test_fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Method analog to the private method :meth:`Data.__define_test_fraction &lt;DNNLikelihood.Data._Data__define_test_fraction&gt;`</span>
<span class="sd">        useful to change the available fraction of train/valifation vs test data.</span>
<span class="sd">        Differently from the analog private method, this one updates the files corresponding to the</span>
<span class="sd">        :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;` and</span>
<span class="sd">        :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;` attributes.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">        - **Updates files**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_fraction</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_fraction</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">test_fraction</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">test_fraction</span><span class="p">))),</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.reset_predictions"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.reset_predictions">[docs]</a>    <span class="k">def</span> <span class="nf">reset_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                          <span class="n">delete_figures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                          <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-initializes the :attr:`Lik.predictions &lt;DNNLikelihood.Lik.predictions&gt;` dictionary to</span>

<span class="sd">         .. code-block:: python</span>

<span class="sd">            predictions = {&quot;logpdf_max&quot;: {},</span>
<span class="sd">                           &quot;logpdf_profiled_max&quot;: {},</span>
<span class="sd">                           &quot;Figures&quot;: figs}</span>

<span class="sd">        Where ``figs`` may be either an empty dictionary or the present value of the corresponding one,</span>
<span class="sd">        depending on the value of the ``delete_figures`` argument.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **delete_figures**</span>
<span class="sd">            </span>
<span class="sd">                If ``True`` all files in the :attr:`Lik.output_figures_folder &lt;DNNLikelihood.Lik.output_figures_folder&gt;` </span>
<span class="sd">                folder are deleted and the ``&quot;Figures&quot;`` item is reset to an empty dictionary.</span>
<span class="sd">                    </span>
<span class="sd">                    - **type**: ``bool``</span>
<span class="sd">                    - **default**: ``True`` </span>
<span class="sd">            </span>
<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete_figures</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">check_delete_all_files_in_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">)</span>
            <span class="n">figs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">All predictions and figures have been deleted and the &#39;predictions&#39; attribute has been initialized.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">figs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">check_figures_dic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">],</span><span class="n">output_figures_folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">All predictions have been deleted and the &#39;predictions&#39; attribute has been initialized. No figure file has been deleted.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Figures&quot;</span><span class="p">:</span> <span class="n">figs</span><span class="p">}</span></div>

<div class="viewcode-block" id="Data.close_opened_dataset"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.close_opened_dataset">[docs]</a>    <span class="k">def</span> <span class="nf">close_opened_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Closes the opened h5py datasets </span>
<span class="sd">        :attr:`Data.opened_dataset &lt;DNNLikelihood.Data.opened_dataset&gt;`.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opened_dataset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opened_dataset</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Closed&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_file</span><span class="p">,</span><span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No dataset to close.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.save_log"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.save_log">[docs]</a>    <span class="k">def</span> <span class="nf">save_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the content of the :attr:`Data.log &lt;DNNLikelihood.Data.log&gt;` attribute in the file</span>
<span class="sd">        :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>

<span class="sd">        This method is called by the methods</span>
<span class="sd">        </span>
<span class="sd">        - :meth:`Data.__init__ &lt;DNNLikelihood.Data.__init__&gt;` with ``overwrite=True`` and ``verbose=verbose_sub``  with ``overwrite=True`` and ``verbose=verbose_sub`` if :attr:`Data.input_file &lt;DNNLikelihood.Data.input_file&gt;` is not ``None``, and with ``overwrite=True`` and ``verbose=verbose_sub`` otherwise</span>
<span class="sd">        - :meth:`Data.save &lt;DNNLikelihood.Data.save&gt;` with ``overwrite=overwrite`` and ``verbose=verbose``</span>
<span class="sd">        - :meth:`Data.generate_train_indices &lt;DNNLikelihood.Data.generate_train_indices&gt;` with ``overwrite=True`` and ``verbose=verbose_sub``</span>
<span class="sd">        - :meth:`Data.generate_train_data &lt;DNNLikelihood.Data.generate_train_data&gt;` with ``overwrite=True`` and ``verbose=verbose_sub``</span>
<span class="sd">        - :meth:`Data.update_train_indices &lt;DNNLikelihood.Data.update_train_indices&gt;` with ``overwrite=True`` and ``verbose=verbose_sub``</span>
<span class="sd">        - :meth:`Data.update_train_data &lt;DNNLikelihood.Data.update_train_data&gt;` with ``overwrite=True`` and ``verbose=verbose_sub``</span>
<span class="sd">        - :meth:`Data.generate_test_indices &lt;DNNLikelihood.Data.generate_test_indices&gt;` with ``overwrite=True`` and ``verbose=verbose_sub``</span>
<span class="sd">        - :meth:`Data.generate_test_data &lt;DNNLikelihood.Data.generate_test_data&gt;` with ``overwrite=True`` and ``verbose=verbose_sub``</span>
<span class="sd">        - :meth:`Data.compute_sample_weights &lt;DNNLikelihood.Data.compute_sample_weights&gt;` with ``overwrite=True`` and ``verbose=verbose_sub``</span>
<span class="sd">        - :meth:`Data.define_scalers &lt;DNNLikelihood.Data.define_scalers&gt;` with ``overwrite=True`` and ``verbose=verbose_sub``</span>

<span class="sd">        This method is called by the</span>
<span class="sd">        :meth:`Data.save &lt;DNNLikelihood.Data.save&gt;` method to save the entire object.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **overwrite**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`overwrite &lt;common_methods_arguments.overwrite&gt;`.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">        - **Creates/updates file**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">check_rename_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_log_file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_types_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_log_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data log file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_log_file</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">updated (or saved if it did not exist) in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data log file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_log_file</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">saved in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">save_predictions_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Save predictions json</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">overwrite</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">output_predictions_json_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_predictions_json_file</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">check_rename_file</span><span class="p">(</span><span class="n">output_predictions_json_file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">overwrite</span> <span class="o">==</span> <span class="s2">&quot;dump&quot;</span><span class="p">:</span>
            <span class="n">output_predictions_json_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">generate_dump_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_predictions_json_file</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">convert_types_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output_predictions_json_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;saved predictions json&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;file name&quot;</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">output_predictions_json_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>
        <span class="c1">#self.save_log(overwrite=True, verbose=verbose_sub) # log saved by save</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">overwrite</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Predictions json file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output_predictions_json_file</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">updated (or saved if it did not exist) in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Predictions json file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output_predictions_json_file</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">saved in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">overwrite</span> <span class="o">==</span> <span class="s2">&quot;dump&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Predictions json file dump</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output_predictions_json_file</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">saved in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

<div class="viewcode-block" id="Data.save_object_h5"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.save_object_h5">[docs]</a>    <span class="k">def</span> <span class="nf">save_object_h5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :class:`Lik &lt;DNNLikelihood.Data&gt;` object is saved to the HDF5 file</span>
<span class="sd">        :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;`, the datasets corresponding to the </span>
<span class="sd">        :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` and :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` attributes</span>
<span class="sd">        are saved to the file :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;`, and the object </span>
<span class="sd">        log is saved to the json file :attr:`Lik.output_log_file &lt;DNNLikelihood.Lik.output_log_file&gt;`.</span>
<span class="sd">        </span>
<span class="sd">        This method saves the content of the :attr:``Lik.__dict__ &lt;DNNLikelihood.Lik.__dict__&gt;`` </span>
<span class="sd">        attribute in the h5 file :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;`</span>
<span class="sd">        using the |deepdish_link| package. The following attributes are excluded from the saved</span>
<span class="sd">        dictionary:</span>

<span class="sd">            - :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;`</span>
<span class="sd">            - :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` (saved to the file :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;`)</span>
<span class="sd">            - :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` (saved to the file :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;`)</span>
<span class="sd">            - :attr:`Data.dtype_required &lt;DNNLikelihood.Data.dtype_required&gt;`</span>
<span class="sd">            - :attr:`Data.input_file &lt;DNNLikelihood.Data.input_file&gt;`</span>
<span class="sd">            - :attr:`Data.input_folder &lt;DNNLikelihood.Data.input_folder&gt;`</span>
<span class="sd">            - :attr:`Data.input_samples_h5_file &lt;DNNLikelihood.Data.input_samples_h5_file&gt;`</span>
<span class="sd">            - :attr:`Data.input_h5_file &lt;DNNLikelihood.Data.input_h5_file&gt;`</span>
<span class="sd">            - :attr:`Data.input_log_file &lt;DNNLikelihood.Data.input_log_file&gt;`</span>
<span class="sd">            - :attr:`Data.load_on_RAM &lt;DNNLikelihood.Data.load_on_RAM&gt;`</span>
<span class="sd">            - :attr:`Data.log &lt;DNNLikelihood.Data.log&gt;` (saved to the file :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`)</span>
<span class="sd">            - :attr:`Data.opened_dataset &lt;DNNLikelihood.Data.opened_dataset&gt;`</span>
<span class="sd">            - :attr:`Data.output_folder &lt;DNNLikelihood.Data.output_folder&gt;`</span>
<span class="sd">            - :attr:`Data.output_figures_folder &lt;DNNLikelihood.Data.output_figures_folder&gt;`</span>
<span class="sd">            - :attr:`Data.output_figures_base_file_name &lt;DNNLikelihood.Data.output_figures_base_file_name&gt;`</span>
<span class="sd">            - :attr:`Data.output_figures_base_file_path &lt;DNNLikelihood.Data.output_figures_base_file_path&gt;`</span>
<span class="sd">            - :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">            - :attr:`Data.test_range &lt;DNNLikelihood.Data.test_range&gt;`</span>
<span class="sd">            - :attr:`Data.train_range &lt;DNNLikelihood.Data.train_range&gt;`</span>
<span class="sd">            - :attr:`Data.verbose &lt;DNNLikelihood.Data.verbose&gt;`</span>

<span class="sd">        This method is called by the</span>
<span class="sd">        :meth:`Data.save &lt;DNNLikelihood.Data.save&gt;` method to save the entire object.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **overwrite**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`overwrite &lt;common_methods_arguments.overwrite&gt;`.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">        - **Produces file**</span>

<span class="sd">            - :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">check_rename_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_h5_file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dic_minus_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;data_dictionary&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;data_X&quot;</span><span class="p">,</span><span class="s2">&quot;data_Y&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;dtype_required&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;input_file&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;input_folder&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;input_samples_h5_file&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;input_h5_file&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;input_log_file&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;load_on_RAM&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;log&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;opened_dataset&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;output_folder&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;output_figures_folder&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;output_figures_base_file_name&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;output_figures_base_file_path&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;output_h5_file&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;output_samples_h5_file&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;output_log_file&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;test_range&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;train_range&quot;</span><span class="p">,</span>
                                                          <span class="s2">&quot;verbose&quot;</span><span class="p">])</span>
        <span class="n">dd</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_h5_file</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;saved&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;file name&quot;</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_h5_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data object saved to file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_h5_file</span><span class="p">,</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.save_samples_h5"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.save_samples_h5">[docs]</a>    <span class="k">def</span> <span class="nf">save_samples_h5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :class:`Lik &lt;DNNLikelihood.Data&gt;` object is saved to the HDF5 file</span>
<span class="sd">        :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;`, the datasets corresponding to the </span>
<span class="sd">        :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` and :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` attributes</span>
<span class="sd">        are saved to the file :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;`, and the object </span>
<span class="sd">        log is saved to the json file :attr:`Lik.output_log_file &lt;DNNLikelihood.Lik.output_log_file&gt;`.</span>
<span class="sd">        </span>
<span class="sd">        This method saves the content of the attributes :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` and</span>
<span class="sd">        :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;`, and an additional entry with the shape of the former</span>
<span class="sd">        in the h5 file :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;`</span>
<span class="sd">        using the |h5py_link| package.</span>
<span class="sd">        </span>
<span class="sd">        This method is called by the :meth:`Data.save &lt;DNNLikelihood.Data.save&gt;` method to save the entire object.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **overwrite**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`overwrite &lt;common_methods_arguments.overwrite&gt;`.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">        - **Produces file**</span>

<span class="sd">            - :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">check_rename_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_samples_h5_file</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>     
        <span class="n">h5_out</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_samples_h5_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">h5_out</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_stored</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_stored</span><span class="p">)</span>
        <span class="n">h5_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;saved&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;file name&quot;</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_samples_h5_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]}</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">),</span> <span class="s2">&quot;data samples (data_X, data_Y) saved to file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_samples_h5_file</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">in&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.save"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :class:`Lik &lt;DNNLikelihood.Data&gt;` object is saved to the HDF5 file</span>
<span class="sd">        :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;`, the datasets corresponding to the </span>
<span class="sd">        :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` and :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` attributes</span>
<span class="sd">        are saved to the file :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;`, and the object </span>
<span class="sd">        log is saved to the json file :attr:`Lik.output_log_file &lt;DNNLikelihood.Lik.output_log_file&gt;`.</span>

<span class="sd">        This method calls in order the three methods</span>
<span class="sd">        </span>
<span class="sd">            - :meth:`Data.save_log &lt;DNNLikelihood.Data.save_json&gt;`</span>
<span class="sd">            - :meth:`Data.save_predictions_json &lt;DNNLikelihood.Data.save_predictions_json&gt;`</span>
<span class="sd">            - :meth:`Data.save_object_h5 &lt;DNNLikelihood.Data.save_object_h5&gt;`</span>
<span class="sd">            - :meth:`Data.save_samples_h5 &lt;DNNLikelihood.Data.save_samples_h5&gt;`</span>

<span class="sd">        to save the full object.</span>

<span class="sd">        - **Arguments**</span>
<span class="sd">            </span>
<span class="sd">            Same arguments as the called methods.</span>

<span class="sd">        - **Produces files**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_predictions_json_file &lt;DNNLikelihood.Data.output_predictions_json_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_h5_file &lt;DNNLikelihood.Data.output_h5_file&gt;`</span>
<span class="sd">            - :attr:`Data.output_samples_h5_file &lt;DNNLikelihood.Data.output_samples_h5_file&gt;` </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_object_h5</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_samples_h5</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_predictions_json</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Data.generate_train_indices"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.generate_train_indices">[docs]</a>    <span class="k">def</span> <span class="nf">generate_train_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints_train</span><span class="p">,</span> <span class="n">npoints_val</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to generate ``npoints_train`` train and ``npoints_val`` validation data indices </span>
<span class="sd">        (integer positions in the </span>
<span class="sd">        :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;`</span>
<span class="sd">        and :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` arrays). It updates the </span>
<span class="sd">        ``&quot;idx_train&quot;`` and ``&quot;idx_val&quot;`` items of the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **npoints_train**</span>

<span class="sd">                Required number of </span>
<span class="sd">                training points.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">            </span>
<span class="sd">            - **npoints_val**</span>

<span class="sd">                Required number of </span>
<span class="sd">                validation points.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **seed**</span>

<span class="sd">                Seed of the random number generator. It is used to initialize </span>
<span class="sd">                the |numpy_link| random state.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">idx_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_range</span><span class="p">,</span> <span class="n">npoints_train</span><span class="o">+</span><span class="n">npoints_val</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">idx_train</span><span class="p">,</span> <span class="n">idx_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">idx_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">npoints_train</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">npoints_val</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_val</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;updated data dictionary&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">,</span> <span class="s2">&quot;idx_val&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;npoints train&quot;</span><span class="p">:</span> <span class="n">npoints_train</span><span class="p">,</span>
                               <span class="s2">&quot;npoints val&quot;</span><span class="p">:</span> <span class="n">npoints_val</span><span class="p">}</span></div>
        <span class="c1">#self.save_log(overwrite=True, verbose=verbose_sub) # log is saved by generate_train_data</span>

<div class="viewcode-block" id="Data.generate_train_data"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.generate_train_data">[docs]</a>    <span class="k">def</span> <span class="nf">generate_train_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints_train</span><span class="p">,</span> <span class="n">npoints_val</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to generate ``npoints_train`` train and ``npoints_val`` validation data.</span>
<span class="sd">        In order to extract the required number of points from the :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;`</span>
<span class="sd">        and :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` arrays (which may not be available on RAM),</span>
<span class="sd">        it first generates indices with the :meth:`Data.generate_train_indices &lt;DNNLikelihood.Data.generate_train_indices&gt;`</span>
<span class="sd">        method and then slices the data with the generated indices.</span>
<span class="sd">        It updates the ``&quot;X_train&quot;``, ``&quot;Y_train&quot;``, ``&quot;X_val&quot;`` and ``&quot;Y_val&quot;`` items of the</span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **npoints_train**</span>

<span class="sd">                Required number of </span>
<span class="sd">                training points.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">            </span>
<span class="sd">            - **npoints_val**</span>

<span class="sd">                Required number of </span>
<span class="sd">                validation points.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **seed**</span>

<span class="sd">                Seed of the random number generator. It is used to initialize </span>
<span class="sd">                the |numpy_link| random state.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_sync_data_dictionary</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_train_indices</span><span class="p">(</span><span class="n">npoints_train</span><span class="p">,</span> <span class="n">npoints_val</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;updated data dictionary&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;X_train&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_train&quot;</span><span class="p">,</span> <span class="s2">&quot;X_val&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_val&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;npoints train&quot;</span><span class="p">:</span> <span class="n">npoints_train</span><span class="p">,</span>
                               <span class="s2">&quot;npoints val&quot;</span><span class="p">:</span> <span class="n">npoints_val</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generated&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">npoints_train</span><span class="p">),</span> <span class="s2">&quot;(X_train, Y_train) samples and &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">npoints_val</span><span class="p">),</span><span class="s2">&quot;(X_val, Y_val) samples in&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.update_train_indices"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.update_train_indices">[docs]</a>    <span class="k">def</span> <span class="nf">update_train_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints_train</span><span class="p">,</span> <span class="n">npoints_val</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analog of :meth:`Data.generate_train_indices &lt;DNNLikelihood.Data.generate_train_indices&gt;`, but it only updates</span>
<span class="sd">        indices adding more points if any are already available in the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>
<span class="sd">        It updates the  ``&quot;idx_train&quot;`` and ``&quot;idx_val&quot;`` items of the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **npoints_train**</span>

<span class="sd">                Required number of </span>
<span class="sd">                training points.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">            </span>
<span class="sd">            - **npoints_val**</span>

<span class="sd">                Required number of </span>
<span class="sd">                validation points.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **seed**</span>

<span class="sd">                Seed of the random number generator. It is used to initialize </span>
<span class="sd">                the |numpy_link| random state.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">existing_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">])))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">idx_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_range</span><span class="p">),</span> <span class="n">existing_train</span><span class="p">),</span> <span class="n">npoints_train</span><span class="o">+</span><span class="n">npoints_val</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">idx_train</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx_train</span><span class="p">,</span> <span class="n">idx_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">idx_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">npoints_train</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">npoints_val</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx_val</span> <span class="o">=</span> <span class="n">idx_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">],</span><span class="n">idx_train</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">],</span><span class="n">idx_val</span><span class="p">)))</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;updated data dictionary&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">,</span> <span class="s2">&quot;idx_val&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;npoints train&quot;</span><span class="p">:</span> <span class="n">npoints_train</span><span class="p">,</span>
                               <span class="s2">&quot;npoints val&quot;</span><span class="p">:</span> <span class="n">npoints_val</span><span class="p">}</span>
        <span class="c1">#self.save_log(overwrite=True, verbose=verbose_sub) # log is saved by update_train_data</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idx_train</span><span class="p">,</span> <span class="n">idx_val</span><span class="p">]</span></div>

<div class="viewcode-block" id="Data.update_train_data"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.update_train_data">[docs]</a>    <span class="k">def</span> <span class="nf">update_train_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints_train</span><span class="p">,</span> <span class="n">npoints_val</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analog of :meth:`Data.generate_train_data &lt;DNNLikelihood.Data.generate_train_data&gt;`, but it only updates</span>
<span class="sd">        data adding more points if any are already available in the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>
<span class="sd">        It updates the  ``&quot;X_train&quot;``, ``&quot;Y_train&quot;``, ``&quot;X_val&quot;`` and ``&quot;Y_val&quot;`` items of the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **npoints_train**</span>

<span class="sd">                Required number of </span>
<span class="sd">                training points.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">            </span>
<span class="sd">            - **npoints_val**</span>

<span class="sd">                Required number of </span>
<span class="sd">                validation points.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **seed**</span>

<span class="sd">                Seed of the random number generator. It is used to initialize </span>
<span class="sd">                the |numpy_link| random state.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_sync_data_dictionary</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="p">[</span><span class="n">npoints_train</span><span class="p">,</span> <span class="n">npoints_val</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">npoints_train</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_train&quot;</span><span class="p">]),</span> 
                                                                            <span class="n">npoints_val</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_val&quot;</span><span class="p">])]]</span>
        <span class="n">idx_train</span><span class="p">,</span> <span class="n">idx_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_train_indices</span><span class="p">(</span><span class="n">npoints_train</span><span class="p">,</span> <span class="n">npoints_val</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx_train</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_train&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="n">idx_train</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="n">idx_train</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_train&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="n">idx_train</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_train&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_train&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="n">idx_train</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx_val</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_val&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="n">idx_val</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="n">idx_val</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_val&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="n">idx_val</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_val&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="n">idx_val</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;updated data dictionary&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;X_train&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_train&quot;</span><span class="p">,</span> <span class="s2">&quot;X_val&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_val&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;npoints train&quot;</span><span class="p">:</span> <span class="n">npoints_train</span><span class="p">,</span>
                               <span class="s2">&quot;npoints val&quot;</span><span class="p">:</span> <span class="n">npoints_val</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Added&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">npoints_train</span><span class="p">),</span> <span class="s2">&quot;(X_train, Y_train) samples and&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">npoints_val</span><span class="p">),</span><span class="s2">&quot;(X_val, Y_val) samples in&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.generate_test_indices"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.generate_test_indices">[docs]</a>    <span class="k">def</span> <span class="nf">generate_test_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints_test</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to generate ``npoints_test`` test data indices </span>
<span class="sd">        (integer positions in the :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;`</span>
<span class="sd">        and :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` arrays). It updates the </span>
<span class="sd">        ``&quot;idx_test&quot;`` item of the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **npoints_test**</span>

<span class="sd">                Required number of </span>
<span class="sd">                test points.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">            </span>
<span class="sd">            - **seed**</span>

<span class="sd">                Seed of the random number generator. It is used to initialize </span>
<span class="sd">                the |numpy_link| random state.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">idx_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_range</span><span class="p">,</span> <span class="n">npoints_test</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_test</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;updated data dictionary&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;npoints test&quot;</span><span class="p">:</span> <span class="n">npoints_test</span><span class="p">}</span></div>
        <span class="c1">#self.save_log(overwrite=True, verbose=verbose_sub) # log is saved by generate_test_data</span>

<div class="viewcode-block" id="Data.generate_test_data"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.generate_test_data">[docs]</a>    <span class="k">def</span> <span class="nf">generate_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints_test</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method used to generate ``npoints_test`` test data.</span>
<span class="sd">        In order to extract the required number of points from the :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;`</span>
<span class="sd">        and :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` arrays (which may not be available on RAM),</span>
<span class="sd">        it first generates indices with the :meth:`Data.generate_test_indices &lt;DNNLikelihood.Data.generate_test_indices&gt;`</span>
<span class="sd">        method and then slices the data with the generated indices.</span>
<span class="sd">        It updates the ``&quot;X_test&quot;`` and ``&quot;Y_test&quot;`` items of the</span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **npoints_test**</span>

<span class="sd">                Required number of</span>
<span class="sd">                test points.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **seed**</span>

<span class="sd">                Seed of the random number generator. It is used to initialize </span>
<span class="sd">                the |numpy_link| random state.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_sync_data_dictionary</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_test_indices</span><span class="p">(</span><span class="n">npoints_test</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;updated data dictionary&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_test&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;npoints test&quot;</span><span class="p">:</span> <span class="n">npoints_test</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generated&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">npoints_test</span><span class="p">),</span> <span class="s2">&quot;(X_test, Y_test) samples in&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">update_test_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints_test</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analog of :meth:`Data.generate_test_indices &lt;DNNLikelihood.Data.generate_test_indices&gt;`, but it only updates</span>
<span class="sd">        indices adding more points if any are already available in the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>
<span class="sd">        It updates the  ``&quot;idx_test&quot;`` item of the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **npoints_test**</span>

<span class="sd">                Required number of </span>
<span class="sd">                test points.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **seed**</span>

<span class="sd">                Seed of the random number generator. It is used to initialize </span>
<span class="sd">                the |numpy_link| random state.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">existing_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">])</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">idx_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_range</span><span class="p">),</span> <span class="n">existing_test</span><span class="p">),</span> <span class="n">npoints_test</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">],</span><span class="n">idx_test</span><span class="p">)))</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;updated data dictionary&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;npoints test&quot;</span><span class="p">:</span> <span class="n">npoints_test</span><span class="p">}</span>
        <span class="c1">#self.save_log(overwrite=True, verbose=verbose_sub) # log is saved by update_test_data</span>
        <span class="k">return</span> <span class="n">idx_test</span>

    <span class="k">def</span> <span class="nf">update_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">npoints_test</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analog of :meth:`Data.generate_test_data &lt;DNNLikelihood.Data.generate_test_data&gt;`, but it only updates</span>
<span class="sd">        data adding more points if any are already available in the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>
<span class="sd">        It updates the  ``&quot;X_test&quot;`` and ``&quot;Y_test&quot;`` items of the </span>
<span class="sd">        :attr:`Data.data_dictionary &lt;DNNLikelihood.Data.data_dictionary&gt;` dictionary.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **npoints_test**</span>

<span class="sd">                Required number of </span>
<span class="sd">                test points.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">            </span>
<span class="sd">            - **seed**</span>

<span class="sd">                Seed of the random number generator. It is used to initialize </span>
<span class="sd">                the |numpy_link| random state.</span>

<span class="sd">                    - **type**: ``int``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_sync_data_dictionary</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="n">npoints_test</span> <span class="o">=</span> <span class="n">npoints_test</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;idx_test&quot;</span><span class="p">])</span>
        <span class="n">idx_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_test_indices</span><span class="p">(</span><span class="n">npoints_test</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx_test</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="n">idx_test</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="n">idx_test</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data_X</span><span class="p">[</span><span class="n">idx_test</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dictionary</span><span class="p">[</span><span class="s2">&quot;Y_test&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span><span class="p">[</span><span class="n">idx_test</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype_required</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;updated data dictionary&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;X_test&quot;</span><span class="p">,</span> <span class="s2">&quot;Y_test&quot;</span><span class="p">],</span>
                               <span class="s2">&quot;npoints test&quot;</span><span class="p">:</span> <span class="n">npoints_test</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Added&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">npoints_test</span><span class="p">),</span> <span class="s2">&quot;(X_test, Y_test) samples in&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

<div class="viewcode-block" id="Data.compute_sample_weights"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.compute_sample_weights">[docs]</a>    <span class="k">def</span> <span class="nf">compute_sample_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that computes weights of points given their distribution. Sample weights are used to weigth data as a function of </span>
<span class="sd">        their frequency, obtained by binning the data in ``nbins`` and assigning weight equal to the inverse of the bin count</span>
<span class="sd">        to the power ``power``. In order to avoid too large weights for bins with very few counts, all bins with less than 5 counts</span>
<span class="sd">        are assigned frequency equal to 1/5 to the power ``power``.</span>
<span class="sd">        </span>
<span class="sd">        - **Arguments**</span>

<span class="sd">            - **sample**</span>

<span class="sd">                Distribution of points that </span>
<span class="sd">                need to be weighted.</span>

<span class="sd">                    - **type**: ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(len(sample),)``</span>

<span class="sd">            - **nbins**</span>

<span class="sd">                Number of bins to histogram the </span>
<span class="sd">                sample data</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">                    - **default**: ``100``</span>

<span class="sd">            - **power**</span>

<span class="sd">                Exponent of the inverse of the bin count used</span>
<span class="sd">                to assign weights.</span>

<span class="sd">                    - **type**: ``float``</span>
<span class="sd">                    - **default**: ``1``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">        - **Returns**</span>

<span class="sd">            |Numpy_link| array of the same length of ``sample`` containing</span>
<span class="sd">            the required weights.</span>
<span class="sd">            </span>
<span class="sd">                - **type**: ``numpy.ndarray``</span>
<span class="sd">                - **shape**: ``(len(sample),)``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">hist</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">hist</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tmp</span> <span class="o">==</span> <span class="n">nbins</span><span class="p">,</span> <span class="n">nbins</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)],</span> <span class="n">power</span><span class="p">)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">W</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;computed sample weights&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sample weights computed in&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">W</span></div>

<div class="viewcode-block" id="Data.define_scalers"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.define_scalers">[docs]</a>    <span class="k">def</span> <span class="nf">define_scalers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_X</span><span class="p">,</span> <span class="n">data_Y</span><span class="p">,</span> <span class="n">scalerX_bool</span><span class="p">,</span> <span class="n">scalerY_bool</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that defines |standard_scalers_link| fit to the ``data_X`` and ``data_Y`` data.</span>
<span class="sd">        Scalers are defined based on the boolean flags ``scalerX_bool`` and ``scalerY_bool``. When the flags are ``False``</span>
<span class="sd">        the scalers are defined with the arguemtns ``with_mean=False`` and ``with_std=False`` which correspond to identity</span>
<span class="sd">        transformations.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **data_X**</span>

<span class="sd">                ``X`` data to fit</span>
<span class="sd">                the |standard_scaler_link| ``scalerX``.</span>

<span class="sd">                    - **type**: ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(npoints,ndim)``</span>

<span class="sd">            - **data_Y**</span>

<span class="sd">                ``Y`` data to fit</span>
<span class="sd">                the |standard_scaler_link| ``scalerY``.</span>

<span class="sd">                    - **type**: ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(npoints,)``</span>

<span class="sd">            - **scalerX_bool**</span>

<span class="sd">                If ``True`` the ``X`` scaler is fit to the ``data_X`` data, otherwise it is set</span>
<span class="sd">                to the identity transformation.</span>

<span class="sd">                    - **type**: ``bool``</span>

<span class="sd">            - **scalerY_bool**</span>

<span class="sd">                If ``True`` the ``Y`` scaler is fit to the ``data_Y`` data, otherwise it is set</span>
<span class="sd">                to the identity transformation.</span>

<span class="sd">                    - **type**: ``bool``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">        - **Returns**</span>

<span class="sd">            List of the form ``[scalerX,scalerY]`` containing </span>
<span class="sd">            the ``X`` and ``Y`` scalers.</span>
<span class="sd">            </span>
<span class="sd">                - **type**: ``list``</span>
<span class="sd">                - **shape**: ``[scalerX,scalerY]``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scalerX_bool</span><span class="p">:</span>
            <span class="n">scalerX</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">scalerX</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_X</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scalerX</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_std</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">scalerX</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_X</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scalerY_bool</span><span class="p">:</span>
            <span class="n">scalerY</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">scalerY</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_Y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scalerY</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_std</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">scalerY</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_Y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;defined scalers&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;scaler X&quot;</span><span class="p">:</span> <span class="n">scalerX_bool</span><span class="p">,</span>
                               <span class="s2">&quot;scaler Y&quot;</span><span class="p">:</span> <span class="n">scalerY_bool</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Standard scalers defined in&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">scalerX</span><span class="p">,</span> <span class="n">scalerY</span><span class="p">]</span></div>

<div class="viewcode-block" id="Data.define_rotation"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.define_rotation">[docs]</a>    <span class="k">def</span> <span class="nf">define_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_X</span><span class="p">,</span> <span class="n">rotationX_bool</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that defines the rotation matrix that diagonalizes the covariance matrix of the ``data_X``,</span>
<span class="sd">        making them uncorrelated.</span>
<span class="sd">        Such matrix is defined based on the boolean flag ``rotationX_bool``. When the flag is ``False``</span>
<span class="sd">        the matrix is set to the identity matrix.</span>
<span class="sd">        </span>
<span class="sd">        Note: Data are transformed with the matrix ``V`` through ``np.dot(X,V)`` and transformed back throug</span>
<span class="sd">        ``np.dot(X_diag,np.transpose(V))``.</span>
<span class="sd">        </span>
<span class="sd">        - **Arguments**</span>

<span class="sd">            - **data_X**</span>

<span class="sd">                ``X`` data to compute the </span>
<span class="sd">                rotation matrix that diagonalizes the covariance matrix.</span>

<span class="sd">                    - **type**: ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(npoints,ndim)``</span>

<span class="sd">            - **rotationX_bool**</span>

<span class="sd">                If ``True`` the rotation matrix is set to the identity matrix.</span>

<span class="sd">                    - **type**: ``bool``</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">        - **Returns**</span>

<span class="sd">            Matrix in the form of a 2D |Numpy_link| </span>
<span class="sd">            array.</span>
<span class="sd">            </span>
<span class="sd">                - **type**: ``numpy.ndarray``</span>
<span class="sd">                - **shape**: ``(ndim,ndim)``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rotationX_bool</span><span class="p">:</span>
            <span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">data_X</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndims</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span> <span class="o">+</span> \
            <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;defined covariance rotation matrix&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;rotation X&quot;</span><span class="p">:</span> <span class="n">rotationX_bool</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Matrix that rotates the correlation matrix defined in&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">V</span></div>

<div class="viewcode-block" id="Data.update_figures"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.update_figures">[docs]</a>    <span class="k">def</span> <span class="nf">update_figures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">figure_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that generates new file names and renames old figure files when new ones are produced with the argument ``overwrite=False``. </span>
<span class="sd">        When ``overwrite=False`` it calls the :func:`utils.check_rename_file &lt;DNNLikelihood.utils.check_rename_file&gt;` function and, if </span>
<span class="sd">        ``figure_file`` already existed in the :attr:`Data.predictions &lt;DNNLikelihood.Data.predictions&gt;` dictionary, then it</span>
<span class="sd">        updates the dictionary by appennding to the old figure name the timestamp corresponding to its generation timestamp </span>
<span class="sd">        (that is the key of the :attr:`Data.predictions[&quot;Figures&quot;] &lt;DNNLikelihood.Data.predictions&gt;` dictionary).</span>
<span class="sd">        When ``overwrite=&quot;dump&quot;`` it calls the :func:`utils.generate_dump_file_name &lt;DNNLikelihood.utils.generate_dump_file_name&gt;` function</span>
<span class="sd">        to generate the dump file name.</span>
<span class="sd">        It returns the new figure_file.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **figure_file**</span>

<span class="sd">                Figure file path. If the figure already exists in the </span>
<span class="sd">                :meth:`Data.predictions &lt;DNNLikelihood.Data.predictions&gt;` dictionary, then its name is updated with the corresponding timestamp.</span>

<span class="sd">            - **overwrite**</span>

<span class="sd">                The method updates file names and :attr:`Data.predictions &lt;DNNLikelihood.Data.predictions&gt;` dictionary only if</span>
<span class="sd">                ``overwrite=False``. If ``overwrite=&quot;dump&quot;`` the method generates and returns the dump file path. </span>
<span class="sd">                If ``overwrite=True`` the method just returns ``figure_file``.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>
<span class="sd">        </span>
<span class="sd">        - **Returns**</span>

<span class="sd">            - **new_figure_file**</span>
<span class="sd">                </span>
<span class="sd">                String identical to the input string ``figure_file`` unless ``verbose=&quot;dump&quot;``.</span>

<span class="sd">        - **Creates/updates files**</span>

<span class="sd">            - Updates ``figure_file`` file name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking and updating figures dictionary&quot;</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">figure_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;figure_file input argument of update_figures method needs to be specified while it is None.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_figure_file</span> <span class="o">=</span> <span class="n">figure_file</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">overwrite</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="c1"># search figure</span>
                    <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">figure_file</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">k</span>
                    <span class="n">old_figure_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">check_rename_file</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">,</span><span class="n">figure_file</span><span class="p">),</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;file_name&quot;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">][</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">figure_file</span><span class="p">,</span><span class="n">old_figure_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span> 
            <span class="k">elif</span> <span class="n">overwrite</span> <span class="o">==</span> <span class="s2">&quot;dump&quot;</span><span class="p">:</span>
                <span class="n">new_figure_file</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">generate_dump_file_name</span><span class="p">(</span><span class="n">figure_file</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_figure_file</span></div>

<div class="viewcode-block" id="Data.data_description"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.data_description">[docs]</a>    <span class="k">def</span> <span class="nf">data_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">pars_labels</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">,</span>
                         <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives a description of data by calling the |Pandas_dataframe_describe|</span>
<span class="sd">        method.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **X**</span>

<span class="sd">                X data to use for the plot. If ``None`` is given the </span>
<span class="sd">                :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` dataset is used.</span>

<span class="sd">                    - **type**: ``list`` or ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(npoints,ndims)``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **pars_labels**</span>

<span class="sd">                    Argument that is passed to the :meth:`Data.__set_pars_labels &lt; DNNLikelihood.Data._Lik__set_pars_labels&gt;`</span>
<span class="sd">                    method to set the parameters labels to be used in the plots.</span>

<span class="sd">                        - **type**: ``list`` or ``str``</span>
<span class="sd">                        - **shape of list**: ``[]``</span>
<span class="sd">                        - **accepted strings**: ``&quot;original&quot;``, ``&quot;generic&quot;``</span>
<span class="sd">                        - **default**: ``original``</span>

<span class="sd">            - **timestamp**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`timestamp &lt;common_methods_arguments.timestamp&gt;`.</span>

<span class="sd">            - **overwrite**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`overwrite &lt;common_methods_arguments.overwrite&gt;`.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">        - **Updates file**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating data description&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">pars_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_pars_labels</span><span class="p">(</span><span class="n">pars_labels</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">pars_labels</span><span class="p">)</span>
        <span class="n">df_description</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">header_string</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data description generated in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_description</span></div>

<div class="viewcode-block" id="Data.plot_X_distributions_summary"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.plot_X_distributions_summary">[docs]</a>    <span class="k">def</span> <span class="nf">plot_X_distributions_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">max_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">nbins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                     <span class="n">pars_labels</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">,</span> 
                                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                                     <span class="n">figure_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">step_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots a summary of all 1D distributions of the parameters in </span>
<span class="sd">        the :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` dataset.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **X**</span>

<span class="sd">                X data to use for the plot. If ``None`` is given the </span>
<span class="sd">                :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` dataset is used.</span>

<span class="sd">                    - **type**: ``list`` or ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(npoints,ndims)``</span>
<span class="sd">                    - **default**: ``None``</span>
<span class="sd">            </span>
<span class="sd">            - **max_points**</span>

<span class="sd">                Maximum number of points used to make</span>
<span class="sd">                the plot. If the numnber is smaller than the total</span>
<span class="sd">                number of available points, then a random subset is taken.</span>
<span class="sd">                If ``None`` then all available points are used.</span>

<span class="sd">                    - **type**: ``int`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **nbins**</span>

<span class="sd">                Number of bins used to make </span>
<span class="sd">                the histograms.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">                    - **default**: ``50``</span>

<span class="sd">            - **pars_labels**</span>

<span class="sd">                Argument that is passed to the :meth:`Data.__set_pars_labels &lt; DNNLikelihood.Data._Lik__set_pars_labels&gt;`</span>
<span class="sd">                method to set the parameters labels to be used in the plots.</span>

<span class="sd">                    - **type**: ``list`` or ``str``</span>
<span class="sd">                    - **shape of list**: ``[]``</span>
<span class="sd">                    - **accepted strings**: ``&quot;original&quot;``, ``&quot;generic&quot;``</span>
<span class="sd">                    - **default**: ``original``</span>

<span class="sd">            - **color**</span>

<span class="sd">                Plot </span>
<span class="sd">                color.</span>

<span class="sd">                    - **type**: ``str``</span>
<span class="sd">                    - **default**: ``&quot;green&quot;``</span>

<span class="sd">            - **figure_file_name**</span>

<span class="sd">                File name for the generated figure. If it is ``None`` (default),</span>
<span class="sd">                it is automatically generated.</span>

<span class="sd">                    - **type**: ``str`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **show_plot**</span>

<span class="sd">                If ``True`` the plot is shown on the</span>
<span class="sd">                interactive console.</span>

<span class="sd">                    - **type**: ``bool``</span>
<span class="sd">                    - **default**: ``False``</span>

<span class="sd">            - **timestamp**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`timestamp &lt;common_methods_arguments.timestamp&gt;`.</span>

<span class="sd">            - **overwrite**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`overwrite &lt;common_methods_arguments.overwrite&gt;`.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">            - **step_kwargs**</span>

<span class="sd">                Additional keyword arguments to pass to the ``plt.step``function.</span>

<span class="sd">                    - **type**: ``dict``</span>

<span class="sd">        - **Updates file**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Plotting 1D distributions summary&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">mplstyle_path</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">pars_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_pars_labels</span><span class="p">(</span><span class="n">pars_labels</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pars_labels</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">max_points</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">max_points</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nnn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">rnd_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span><span class="n">size</span><span class="o">=</span><span class="n">nnn</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">sqrt_n_plots</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sqrt_n_plots</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">sqrt_n_plots</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">sqrt_n_plots</span><span class="p">,</span><span class="n">sqrt_n_plots</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">counts</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">rnd_indices</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="n">nbins</span><span class="p">)</span>
            <span class="n">integral</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">counts</span><span class="o">/</span><span class="n">integral</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span><span class="o">**</span><span class="n">step_kwargs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">pars_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">figure_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="n">figure_file_name</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_base_file_name</span><span class="o">+</span><span class="s2">&quot;_pars_summary.pdf&quot;</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span> 
        <span class="n">utils</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">,</span> <span class="n">figure_file_name</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">check_set_dict_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">],[</span><span class="n">timestamp</span><span class="p">],[[]],</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">append_without_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">][</span><span class="n">timestamp</span><span class="p">],</span> <span class="n">figure_file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;saved figure&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;file name&quot;</span><span class="p">:</span> <span class="n">figure_file_name</span><span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">header_string</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Figure file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">figure_file_name</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">created and saved in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.plot_X_distributions"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.plot_X_distributions">[docs]</a>    <span class="k">def</span> <span class="nf">plot_X_distributions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                             <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">pars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">max_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">nbins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                             <span class="n">pars_labels</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">,</span> 
                             <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                             <span class="n">figure_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">step_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots 1D distributions of the parameters ``pars`` in </span>
<span class="sd">        the :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` dataset.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **X**</span>

<span class="sd">                X data to use for the plot. If ``None`` is given the </span>
<span class="sd">                :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` dataset is used.</span>

<span class="sd">                    - **type**: ``list`` or ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(npoints,ndims)``</span>
<span class="sd">                    - **default**: ``None``</span>
<span class="sd">            </span>
<span class="sd">            - **pars**</span>

<span class="sd">                List of parameters </span>
<span class="sd">                for which the plots are produced.</span>

<span class="sd">                    - **type**: ``list`` or ``None``</span>
<span class="sd">                    - **shape of list**: ``[ ]``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **max_points**</span>

<span class="sd">                Maximum number of points used to make</span>
<span class="sd">                the plot. If the numnber is smaller than the total</span>
<span class="sd">                number of available points, then a random subset is taken.</span>
<span class="sd">                If ``None`` then all available points are used.</span>

<span class="sd">                    - **type**: ``int`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **nbins**</span>

<span class="sd">                Number of bins used to make </span>
<span class="sd">                the histograms.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">                    - **default**: ``50``</span>

<span class="sd">            - **pars_labels**</span>

<span class="sd">                Argument that is passed to the :meth:`Data.__set_pars_labels &lt; DNNLikelihood.Data._Lik__set_pars_labels&gt;`</span>
<span class="sd">                method to set the parameters labels to be used in the plots.</span>

<span class="sd">                    - **type**: ``list`` or ``str``</span>
<span class="sd">                    - **shape of list**: ``[]``</span>
<span class="sd">                    - **accepted strings**: ``&quot;original&quot;``, ``&quot;generic&quot;``</span>
<span class="sd">                    - **default**: ``original``</span>

<span class="sd">            - **color**</span>

<span class="sd">                Plot </span>
<span class="sd">                color.</span>

<span class="sd">                    - **type**: ``str``</span>
<span class="sd">                    - **default**: ``&quot;green&quot;``</span>

<span class="sd">            - **figure_file_name**</span>

<span class="sd">                File name for the generated figure. If it is ``None`` (default),</span>
<span class="sd">                it is automatically generated.</span>

<span class="sd">                    - **type**: ``str`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **show_plot**</span>

<span class="sd">                If ``True`` the plot is shown on the</span>
<span class="sd">                interactive console.</span>

<span class="sd">                    - **type**: ``bool``</span>
<span class="sd">                    - **default**: ``False``</span>

<span class="sd">            - **timestamp**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`timestamp &lt;common_methods_arguments.timestamp&gt;`.</span>

<span class="sd">            - **overwrite**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`overwrite &lt;common_methods_arguments.overwrite&gt;`.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">            - **step_kwargs**</span>

<span class="sd">                Additional keyword arguments to pass to the ``plt.step`` function.</span>

<span class="sd">                    - **type**: ``dict``</span>

<span class="sd">        - **Updates file**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Plotting 1D distributions summary&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">mplstyle_path</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">pars_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_pars_labels</span><span class="p">(</span><span class="n">pars_labels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_points</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">max_points</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nnn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">rnd_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span><span class="n">size</span><span class="o">=</span><span class="n">nnn</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">rnd_indices</span><span class="p">,</span><span class="n">par</span><span class="p">],</span> <span class="n">nbins</span><span class="p">)</span>
            <span class="n">integral</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">counts</span><span class="o">/</span><span class="n">integral</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span><span class="o">**</span><span class="n">step_kwargs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">pars_labels</span><span class="p">[</span><span class="n">par</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;number of samples&quot;</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">figure_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="n">figure_file_name</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_base_file_name</span><span class="o">+</span><span class="s2">&quot;_1D_distr_par_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">par</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span> 
            <span class="n">utils</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">,</span> <span class="n">figure_file_name</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">check_set_dict_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">],[</span><span class="n">timestamp</span><span class="p">],[[]],</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">append_without_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">][</span><span class="n">timestamp</span><span class="p">],</span> <span class="n">figure_file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;saved figure&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;file name&quot;</span><span class="p">:</span> <span class="n">figure_file_name</span><span class="p">}</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">header_string</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Figure file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">figure_file_name</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">created and saved in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.plot_Y_distribution"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.plot_Y_distribution">[docs]</a>    <span class="k">def</span> <span class="nf">plot_Y_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">Y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">max_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">nbins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                            <span class="n">figure_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">step_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the distribution of the data in</span>
<span class="sd">        the :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` dataset.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **Y**</span>

<span class="sd">                Y data to use for the plot. If ``None`` is given the </span>
<span class="sd">                :attr:`Data.data_Y &lt;DNNLikelihood.Data.data_Y&gt;` dataset is used.</span>

<span class="sd">                    - **type**: ``list`` or ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(npoints,ndims)``</span>
<span class="sd">                    - **default**: ``None``</span>
<span class="sd">                    </span>
<span class="sd">            - **max_points**</span>

<span class="sd">                Maximum number of points used to make</span>
<span class="sd">                the plot. If the numnber is smaller than the total</span>
<span class="sd">                number of available points, then a random subset is taken.</span>
<span class="sd">                If ``None`` then all available points are used.</span>

<span class="sd">                    - **type**: ``int`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **log**</span>

<span class="sd">                If ``True`` the plot is made in</span>
<span class="sd">                log scale</span>

<span class="sd">                    - **type**: ``bool``</span>
<span class="sd">                    - **default**: ``True``</span>

<span class="sd">            - **nbins**</span>

<span class="sd">                Number of bins used to make </span>
<span class="sd">                the histograms.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">                    - **default**: ``50``</span>

<span class="sd">            - **color**</span>

<span class="sd">                Plot </span>
<span class="sd">                color.</span>

<span class="sd">                    - **type**: ``str``</span>
<span class="sd">                    - **default**: ``&quot;green&quot;``</span>

<span class="sd">            - **figure_file_name**</span>

<span class="sd">                File name for the generated figure. If it is ``None`` (default),</span>
<span class="sd">                it is automatically generated.</span>

<span class="sd">                    - **type**: ``str`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **show_plot**</span>

<span class="sd">                If ``True`` the plot is shown on the</span>
<span class="sd">                interactive console.</span>

<span class="sd">                    - **type**: ``bool``</span>
<span class="sd">                    - **default**: ``False``</span>

<span class="sd">            - **timestamp**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`timestamp &lt;common_methods_arguments.timestamp&gt;`.</span>

<span class="sd">            - **overwrite**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`overwrite &lt;common_methods_arguments.overwrite&gt;`.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">            - **step_kwargs**</span>

<span class="sd">                Additional keyword arguments to pass to the ``plt.step`` function.</span>

<span class="sd">                    - **type**: ``dict``</span>

<span class="sd">        - **Updates file**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Plotting 1D distributions summary&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span> <span class="o">+</span> \
                <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">mplstyle_path</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">Y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_Y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_points</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">max_points</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nnn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">rnd_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="n">nnn</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">counts</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">rnd_indices</span><span class="p">],</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="n">integral</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">counts</span><span class="o">/</span><span class="n">integral</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">step_kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Y data&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;number of samples&quot;</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">figure_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="n">figure_file_name</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_base_file_name</span><span class="o">+</span><span class="s2">&quot;_Y_distribution.pdf&quot;</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">,</span> <span class="n">figure_file_name</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">check_set_dict_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">timestamp</span><span class="p">],</span> <span class="p">[[]],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">append_without_duplicate</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">][</span><span class="n">timestamp</span><span class="p">],</span> <span class="n">figure_file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;saved figure&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;file name&quot;</span><span class="p">:</span> <span class="n">figure_file_name</span><span class="p">}</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">header_string</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Figure file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">figure_file_name</span><span class="p">),</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">created and saved in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_log</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose_sub</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.plot_corners_1samp"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.plot_corners_1samp">[docs]</a>    <span class="k">def</span> <span class="nf">plot_corners_1samp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">intervals</span><span class="o">=</span><span class="n">inference</span><span class="o">.</span><span class="n">CI_from_sigma</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> 
                           <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">pars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">max_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">nbins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> 
                           <span class="n">pars_labels</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">,</span>
                           <span class="n">ranges_extend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> 
                           <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
                           <span class="n">plot_title</span><span class="o">=</span><span class="s2">&quot;Corner plot&quot;</span><span class="p">,</span> 
                           <span class="n">legend_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">figure_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                           <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                           <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="o">**</span><span class="n">corner_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the 1D and 2D distributions (corner plot) of the distribution of the parameters ``pars`` in the ``X`` array.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **X**</span>

<span class="sd">                X data to use for the plot. If ``None`` is given the </span>
<span class="sd">                :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` dataset is used.</span>

<span class="sd">                    - **type**: ``list`` or ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(npoints,ndims)``</span>
<span class="sd">                    - **default**: ``None``</span>
<span class="sd">                    </span>
<span class="sd">            - **intervals**</span>

<span class="sd">                Probability intervals for which </span>
<span class="sd">                contours are drawn.</span>

<span class="sd">                    - **type**: ``list`` or ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(nintervals,)``</span>
<span class="sd">                    - **default**: ``numpy.array([0.68268949, 0.95449974, 0.9973002])`` (corresponding to 1,2, and 3 sigmas for a 1D Gaussian distribution)</span>

<span class="sd">            - **weights**</span>

<span class="sd">                List or |Numpy_link| array with the </span>
<span class="sd">                Weights correspomnding to the ``X`` points</span>

<span class="sd">                    - **type**: ``list`` or ``numpy.ndarray`` or ``None``</span>
<span class="sd">                    - **shape**: ``(npoints,)``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **pars**</span>

<span class="sd">                List of parameters </span>
<span class="sd">                for which the plots are produced.</span>

<span class="sd">                    - **type**: ``list`` or ``None``</span>
<span class="sd">                    - **shape of list**: ``[ ]``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **max_points**</span>

<span class="sd">                Maximum number of points used to make</span>
<span class="sd">                the plot. If the numnber is smaller than the total</span>
<span class="sd">                number of available points, then a random subset is taken.</span>
<span class="sd">                If ``None`` then all available points are used.</span>

<span class="sd">                    - **type**: ``int`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **nbins**</span>

<span class="sd">                Number of bins used to make </span>
<span class="sd">                the histograms.</span>

<span class="sd">                    - **type**: ``int``</span>
<span class="sd">                    - **default**: ``50``</span>

<span class="sd">            - **pars_labels**</span>

<span class="sd">                Argument that is passed to the :meth:`Data.__set_pars_labels &lt; DNNLikelihood.Data._Lik__set_pars_labels&gt;`</span>
<span class="sd">                method to set the parameters labels to be used in the plots.</span>

<span class="sd">                    - **type**: ``list`` or ``str``</span>
<span class="sd">                    - **shape of list**: ``[]``</span>
<span class="sd">                    - **accepted strings**: ``&quot;original&quot;``, ``&quot;generic&quot;``</span>
<span class="sd">                    - **default**: ``original``</span>

<span class="sd">            - **ranges_extend**</span>

<span class="sd">                Percent increase or reduction of the range of the plots with respect</span>
<span class="sd">                to the range automatically determined from the points values.</span>

<span class="sd">                    - **type**: ``int`` or ``float`` or ``None``</span>

<span class="sd">            - **title**</span>

<span class="sd">                Subplot title to which the </span>
<span class="sd">                68% HPDI values are appended.</span>

<span class="sd">                    - **type**: ``str`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **color**</span>

<span class="sd">                Plot </span>
<span class="sd">                color.</span>

<span class="sd">                    - **type**: ``str``</span>
<span class="sd">                    - **default**: ``&quot;green&quot;``</span>

<span class="sd">            - **plot_title**</span>

<span class="sd">                Title of the corner </span>
<span class="sd">                plot.</span>

<span class="sd">                    - **type**: ``str``</span>
<span class="sd">                    - **default**: ``&quot;Corner plot&quot;``</span>

<span class="sd">            - **legend_labels**</span>

<span class="sd">                List of strings. Labels for the contours corresponding to the </span>
<span class="sd">                ``intervals`` to show in the legend.</span>
<span class="sd">                If ``None`` the legend automatically reports the intervals.</span>

<span class="sd">                    - **type**: ``str`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **figure_file_name**</span>

<span class="sd">                File name for the generated figure. If it is ``None`` (default),</span>
<span class="sd">                it is automatically generated.</span>

<span class="sd">                    - **type**: ``str`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **show_plot**</span>

<span class="sd">                If ``True`` the plot is shown on the</span>
<span class="sd">                interactive console.</span>

<span class="sd">                    - **type**: ``bool``</span>
<span class="sd">                    - **default**: ``False``</span>

<span class="sd">            - **timestamp**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`timestamp &lt;common_methods_arguments.timestamp&gt;`.</span>

<span class="sd">            - **overwrite**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`overwrite &lt;common_methods_arguments.overwrite&gt;`.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">            - **corner_kwargs**</span>

<span class="sd">                Additional keyword arguments to pass to the ``corner`` function.</span>

<span class="sd">                    - **type**: ``dict``</span>

<span class="sd">        - **Updates file**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Plotting 2D marginal posterior density&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">legend_labels</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">legend_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Legend labels should either be None or a list of strings with the same length as intervals.&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">mplstyle_path</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">weigths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.3</span>
        <span class="k">if</span> <span class="n">ranges_extend</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ranges</span> <span class="o">=</span> <span class="n">extend_corner_range</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ranges</span> <span class="o">=</span> <span class="n">extend_corner_range</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">ranges_extend</span><span class="p">)</span>
        <span class="n">pars_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_pars_labels</span><span class="p">(</span><span class="n">pars_labels</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pars_labels</span><span class="p">)[</span><span class="n">pars</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">nndims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_points</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">max_points</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">nnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">max_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">max_points</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nnn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">rnd_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span> <span class="n">nnn</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">samp</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">rnd_idx</span><span class="p">][:,</span><span class="n">pars</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">rnd_idx</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing HPDIs.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">HPDI</span> <span class="o">=</span> <span class="p">[</span><span class="n">inference</span><span class="o">.</span><span class="n">HPDI</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">intervals</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">print_hist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optimize_binning</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nndims</span><span class="p">)]</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">inference</span><span class="o">.</span><span class="n">HPD_quotas</span><span class="p">(</span><span class="n">samp</span><span class="p">[:,[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]],</span> <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">intervals</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nndims</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nndims</span><span class="p">)])</span>
        <span class="n">corner_kwargs_default</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;labels&quot;</span><span class="p">:</span>  <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">],</span>
                                 <span class="s2">&quot;max_n_ticks&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> 
                                 <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
                                 <span class="s2">&quot;plot_contours&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="s2">&quot;smooth&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> 
                                 <span class="s2">&quot;smooth1d&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="n">ranges</span><span class="p">,</span>
                                 <span class="s2">&quot;plot_datapoints&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> 
                                 <span class="s2">&quot;plot_density&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> 
                                 <span class="s2">&quot;fill_contours&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> 
                                 <span class="s2">&quot;normalize1d&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                 <span class="s2">&quot;hist_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="s2">&quot;1.5&quot;</span><span class="p">},</span> 
                                 <span class="s2">&quot;label_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">},</span> 
                                 <span class="s2">&quot;show_titles&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                                 <span class="s2">&quot;title_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">},</span> 
                                 <span class="s2">&quot;levels_lists&quot;</span><span class="p">:</span> <span class="n">levels</span><span class="p">,</span>
                                 <span class="s2">&quot;data_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                                 <span class="s2">&quot;contour_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;linestyles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span> <span class="s2">&quot;dashdot&quot;</span><span class="p">,</span> <span class="s2">&quot;dashed&quot;</span><span class="p">][:</span><span class="nb">len</span><span class="p">(</span><span class="n">HPDI</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span> <span class="s2">&quot;linewidths&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">][:</span><span class="nb">len</span><span class="p">(</span><span class="n">HPDI</span><span class="p">[</span><span class="mi">0</span><span class="p">])]},</span>
                                 <span class="s2">&quot;no_fill_contours&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> 
                                 <span class="s2">&quot;contourf_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;colors&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span> <span class="n">color</span><span class="p">],</span> <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
        <span class="n">corner_kwargs_default</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dic_minus_keys</span><span class="p">(</span><span class="n">corner_kwargs_default</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">corner_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">corner_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">corner_kwargs</span><span class="p">,</span><span class="o">**</span><span class="n">corner_kwargs_default</span><span class="p">}</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nndims</span><span class="p">,</span> <span class="n">nndims</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">nndims</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">nndims</span><span class="p">))</span>
        <span class="n">figure</span> <span class="o">=</span> <span class="n">corner</span><span class="p">(</span><span class="n">samp</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">corner_kwargs</span><span class="p">)</span>
                        <span class="c1"># , levels=(0.393,0.68,)) ,levels=[300],levels_lists=levels1)#,levels=[120])</span>
        <span class="c1">#figure = corner(samp, bins=nbins, weights=weights, labels=[r&quot;%s&quot; % s for s in labels],</span>
        <span class="c1">#                fig=fig, max_n_ticks=6, color=color, plot_contours=True, smooth=True,</span>
        <span class="c1">#                smooth1d=True, range=ranges, plot_datapoints=True, plot_density=False,</span>
        <span class="c1">#                fill_contours=False, normalize1d=True, hist_kwargs={&quot;color&quot;: color, &quot;linewidth&quot;: &quot;1.5&quot;},</span>
        <span class="c1">#                label_kwargs={&quot;fontsize&quot;: 16}, show_titles=False, title_kwargs={&quot;fontsize&quot;: 18},</span>
        <span class="c1">#                levels_lists=levels, data_kwargs={&quot;alpha&quot;: 1},</span>
        <span class="c1">#                contour_kwargs={&quot;linestyles&quot;: [&quot;dotted&quot;, &quot;dashdot&quot;, &quot;dashed&quot;][:len(</span>
        <span class="c1">#                    HPDI[0])], &quot;linewidths&quot;: [linewidth, linewidth, linewidth][:len(HPDI[0])]},</span>
        <span class="c1">#                no_fill_contours=False, contourf_kwargs={&quot;colors&quot;: [&quot;white&quot;, &quot;lightgreen&quot;, color], &quot;alpha&quot;: 1}, **kwargs)</span>
        <span class="c1">#                # , levels=(0.393,0.68,)) ,levels=[300],levels_lists=levels1)#,levels=[120])</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">figure</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nndims</span><span class="p">,</span> <span class="n">nndims</span><span class="p">))</span>
        <span class="n">lines_array</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">lineStyles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">linestyles</span> <span class="o">=</span> <span class="p">(</span><span class="n">lines_array</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">lines_array</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">lines_array</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">)]</span>
        <span class="n">intervals_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;\%$ HPDI&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">intervals</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nndims</span><span class="p">):</span>
            <span class="n">title_i</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="c1">#ax.axvline(value1[i], color=&quot;green&quot;,alpha=1)</span>
            <span class="c1">#ax.axvline(value2[i], color=&quot;red&quot;,alpha=1)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">hists_1d</span> <span class="o">=</span> <span class="n">get_1d_hist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">samp</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">normalize1d</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># ,intervals=HPDI681)</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">HPDI</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">intervals</span><span class="p">[</span><span class="n">q</span><span class="p">]][</span><span class="s2">&quot;Intervals&quot;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">hists_1d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">hists_1d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">hists_1d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">hists_1d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">j</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
                <span class="n">title_i</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;: [&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{0:1.2e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">HPDI</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">intervals</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;Intervals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{0:1.2e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">HPDI</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">intervals</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;Intervals&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;]&quot;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_i</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nndims</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yi</span><span class="p">):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">yi</span><span class="p">,</span> <span class="n">xi</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">xi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">plot_title</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>
        <span class="c1">#fig.text(0.5 ,1, r&quot;%s&quot; % plot_title, fontsize=26)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">]</span>
        <span class="n">red_patch</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># , label=&quot;The red data&quot;)</span>
        <span class="c1">#blue_patch = matplotlib.patches.Patch(color=colors[1])  # , label=&quot;The blue data&quot;)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">linestyles</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">legend_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">legend_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">intervals_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">))]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">legend_labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nndims</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span><span class="c1">#(1/nndims*1.05,1/nndims*1.1))#transform=axes[0,0].transAxes)# loc=(0.53, 0.8))</span>
        <span class="c1">#plt.tight_layout()</span>
        <span class="k">if</span> <span class="n">figure_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="n">figure_file_name</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_base_file_name</span><span class="o">+</span><span class="s2">&quot;_corner_posterior_1samp_pars_&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">])</span> <span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span> 
        <span class="n">utils</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">,</span> <span class="n">figure_file_name</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">check_set_dict_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">],[</span><span class="n">timestamp</span><span class="p">],[[]],</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">append_without_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">][</span><span class="n">timestamp</span><span class="p">],</span> <span class="n">figure_file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;saved figure&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;file name&quot;</span><span class="p">:</span> <span class="n">figure_file_name</span><span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">header_string</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Figure file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">figure_file_name</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">created and saved in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="Data.plot_correlation_matrix"><a class="viewcode-back" href="../../data/methods.html#DNNLikelihood.Data.plot_correlation_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">plot_correlation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                <span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">pars_labels</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">,</span>
                                <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">figure_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                <span class="n">show_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                <span class="o">**</span><span class="n">matshow_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the correlation matrix of the  </span>
<span class="sd">        :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` dataset.</span>

<span class="sd">        - **Arguments**</span>

<span class="sd">            - **X**</span>

<span class="sd">                X data to use for the plot. If ``None`` is given the </span>
<span class="sd">                :attr:`Data.data_X &lt;DNNLikelihood.Data.data_X&gt;` dataset is used.</span>

<span class="sd">                    - **type**: ``list`` or ``numpy.ndarray``</span>
<span class="sd">                    - **shape**: ``(npoints,ndims)``</span>
<span class="sd">                    - **default**: ``None``</span>
<span class="sd">                    </span>
<span class="sd">            - **pars_labels**</span>

<span class="sd">                Argument that is passed to the :meth:`Data.__set_pars_labels &lt; DNNLikelihood.Data._Lik__set_pars_labels&gt;`</span>
<span class="sd">                method to set the parameters labels to be used in the plots.</span>

<span class="sd">                    - **type**: ``list`` or ``str``</span>
<span class="sd">                    - **shape of list**: ``[]``</span>
<span class="sd">                    - **accepted strings**: ``&quot;original&quot;``, ``&quot;generic&quot;``</span>
<span class="sd">                    - **default**: ``original``</span>

<span class="sd">            - **title**</span>

<span class="sd">                Subplot title to which the </span>
<span class="sd">                68% HPDI values are appended.</span>

<span class="sd">                    - **type**: ``str`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **figure_file_name**</span>

<span class="sd">                File name for the generated figure. If it is ``None`` (default),</span>
<span class="sd">                it is automatically generated.</span>

<span class="sd">                    - **type**: ``str`` or ``None``</span>
<span class="sd">                    - **default**: ``None``</span>

<span class="sd">            - **show_plot**</span>

<span class="sd">                If ``True`` the plot is shown on the</span>
<span class="sd">                interactive console.</span>

<span class="sd">                    - **type**: ``bool``</span>
<span class="sd">                    - **default**: ``False``</span>

<span class="sd">            - **timestamp**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`timestamp &lt;common_methods_arguments.timestamp&gt;`.</span>

<span class="sd">            - **overwrite**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`overwrite &lt;common_methods_arguments.overwrite&gt;`.</span>

<span class="sd">            - **verbose**</span>
<span class="sd">            </span>
<span class="sd">                See :argument:`verbose &lt;common_methods_arguments.verbose&gt;`.</span>

<span class="sd">            - **step_kwargs**</span>

<span class="sd">                Additional keyword arguments to pass to the ``plt.matshow`` function.</span>

<span class="sd">                    - **type**: ``dict``</span>

<span class="sd">        - **Updates file**</span>

<span class="sd">            - :attr:`Data.output_log_file &lt;DNNLikelihood.Data.output_log_file&gt;`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">verbose</span><span class="p">,</span> <span class="n">verbose_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">header_string</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Plotting X data correlation matrix&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">mplstyle_path</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Correlation Matrix&quot;</span>
        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_X</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">pars_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_pars_labels</span><span class="p">(</span><span class="n">pars_labels</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">fignum</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="o">**</span><span class="n">matshow_kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">([</span><span class="s1">&#39;number&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">pars_labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">([</span><span class="s1">&#39;number&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">pars_labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation Matrix&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">figure_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="n">figure_file_name</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">figure_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_figures</span><span class="p">(</span><span class="n">figure_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_base_file_name</span><span class="o">+</span><span class="s2">&quot;_correlation_matrix.pdf&quot;</span><span class="p">,</span><span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span> 
        <span class="n">utils</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_figures_folder</span><span class="p">,</span> <span class="n">figure_file_name</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">check_set_dict_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">],[</span><span class="n">timestamp</span><span class="p">],[[]],</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">append_without_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;Figures&quot;</span><span class="p">][</span><span class="n">timestamp</span><span class="p">],</span> <span class="n">figure_file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;datetime_&quot;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S_</span><span class="si">%f</span><span class="s2">Z&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;saved figure&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;file name&quot;</span><span class="p">:</span> <span class="n">figure_file_name</span><span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">header_string</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Figure file</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">figure_file_name</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">created and saved in&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">),</span> <span class="s2">&quot;s.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Andrea Coccaro; Maurizio Pierini; Luca Silvestrini; Riccardo Torre

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>